<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ø­Ø§Ø³Ø¨Ø© Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…Ø´Ø§ÙˆÙŠØ±</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0f1115">
  <style>
    :root{--bg:#0f1115;--card:#171a21;--text:#e9eef4;--muted:#9aa4b2;--acc:#2dd4bf;--danger:#ef4444;border:none}
    *{box-sizing:border-box} body{margin:0;font-family:system-ui,Segoe UI,Arial;background:var(--bg);color:var(--text)}
    header{padding:20px 16px;text-align:center;border-bottom:1px solid #222}
    h1{margin:0;font-size:22px}
    .container{max-width:800px;margin:20px auto;padding:0 12px}
    .card{background:var(--card);border:1px solid #222;border-radius:14px;padding:16px;margin-bottom:14px}
    .row{display:grid;gap:10px;grid-template-columns:1fr 1fr}
    .row .full{grid-column:1/-1}
    label{font-size:13px;color:var(--muted)}
    input,select,button{width:100%;padding:12px;border-radius:10px;border:1px solid #2a2f3a;background:#0c0f14;color:#e9eef4}
    input:focus,select:focus{outline:2px solid #2dd4bf}
    button{background:var(--acc);color:#071d1a;border:none;cursor:pointer;font-weight:600}
    button.secondary{background:#0c0f14;border:1px solid #2a2f3a;color:#e9eef4}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
    .tab{padding:8px 10px;border-radius:999px;border:1px solid #2a2f3a;background:#0c0f14;color:#e9eef4;cursor:pointer;font-size:13px}
    .tab.active{background:var(--acc);color:#06221e;border-color:transparent}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{border-bottom:1px solid #21242b;padding:10px;font-size:14px}
    th{color:var(--muted);font-weight:600}
    .right{text-align:left}
    .muted{color:var(--muted);font-size:13px}
    .total{display:flex;gap:10px;flex-wrap:wrap}
    .chip{background:#0c0f14;border:1px solid #2a2f3a;border-radius:10px;padding:10px 12px}
    .danger{color:#fca5a5}
    footer{padding:24px 16px;text-align:center;color:#6b7280;font-size:12px}
    @media (max-width:720px){.row{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header><h1>ğŸš• Ø­Ø§Ø³Ø¨Ø© Ø£Ø±Ø¨Ø§Ø­ Ø§Ù„Ù…Ø´Ø§ÙˆÙŠØ±</h1></header>

  <div class="container">

    <!-- Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø­Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© -->
    <div class="card">
      <h3 style="margin-top:0">Ø¥Ø¶Ø§ÙØ© Ù…Ø´ÙˆØ§Ø±</h3>
      <div class="row">
        <div>
          <label>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„ (Ù‚Ø¨Ù„ Ø®ØµÙ… Ø§Ù„Ù…Ù†ØµØ©) â€“ Ø±ÙŠØ§Ù„</label>
          <input id="income" type="number" min="0" step="0.5" placeholder="Ù…Ø«Ø§Ù„: 260">
        </div>
        <div>
          <label>ØªÙƒÙ„ÙØ© Ø§Ù„Ø¨Ù†Ø²ÙŠÙ† â€“ Ø±ÙŠØ§Ù„</label>
          <input id="fuel" type="number" min="0" step="0.5" placeholder="Ù…Ø«Ø§Ù„: 35">
        </div>
        <div>
          <label>Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ù†ØµØ© % (Ø£ÙˆØ¨Ø±/ÙƒØ±ÙŠÙ…..)</label>
          <input id="platform" type="number" min="0" step="0.5" placeholder="Ù…Ø«Ø§Ù„: 25">
        </div>
        <div>
          <label>Ù…ØµØ±ÙˆÙØ§Øª Ø£Ø®Ø±Ù‰ (Ù…ÙˆØ§Ù‚Ù/Ù…ÙŠØ§Ù‡..) â€“ Ø±ÙŠØ§Ù„</label>
          <input id="extras" type="number" min="0" step="0.5" placeholder="Ù…Ø«Ø§Ù„: 10">
        </div>
        <div>
          <label>Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ÙØ¹Ù„ÙŠØ©</label>
          <input id="hours" type="number" min="0" step="0.5" placeholder="Ù…Ø«Ø§Ù„: 5.5">
        </div>
        <div>
          <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…Ø´ÙˆØ§Ø±</label>
          <input id="date" type="date">
        </div>
        <div class="full">
          <button id="addBtn">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…Ø´ÙˆØ§Ø±</button>
        </div>
      </div>
      <div class="muted">ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠÙ‹Ø§ (offline) â€“ ØªÙ‚Ø¯Ø± ØªØµØ¯Ù‘Ø± CSV.</div>
    </div>

    <!-- Ø§Ù„ÙÙ„Ø§ØªØ± Ùˆ Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
    <div class="card">
      <div class="tabs" id="filters">
        <button class="tab active" data-range="all">Ø§Ù„ÙƒÙ„</button>
        <button class="tab" data-range="day">ÙŠÙˆÙ…ÙŠ</button>
        <button class="tab" data-range="week">Ø£Ø³Ø¨ÙˆØ¹ÙŠ</button>
        <button class="tab" data-range="month">Ø´Ù‡Ø±ÙŠ</button>
        <button class="tab" data-range="year">Ø³Ù†ÙˆÙŠ</button>
      </div>

      <table id="table">
        <thead>
          <tr>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ù„Ø¯Ø®Ù„</th>
            <th>Ø¨Ù†Ø²ÙŠÙ†</th>
            <th>Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ù†ØµØ©</th>
            <th>Ù…ØµØ±ÙˆÙØ§Øª</th>
            <th>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</th>
            <th class="right">Ø­Ø°Ù</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap">
        <button class="secondary" id="exportCsv">ØªØµØ¯ÙŠØ± CSV</button>
        <button class="secondary" id="clearAll">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
      </div>
    </div>

    <!-- Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª -->
    <div class="card">
      <h3 style="margin-top:0">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª (Ø­Ø³Ø¨ Ø§Ù„ÙÙ„ØªØ± Ø§Ù„Ù…Ø®ØªØ§Ø±)</h3>
      <div class="total">
        <div class="chip">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯Ø®Ù„: <b id="sumIncome">0</b> Ø±ÙŠØ§Ù„</div>
        <div class="chip danger">Ø®ØµÙ… Ø§Ù„Ù…Ù†ØµØ©: <b id="sumPlatform">0</b> Ø±ÙŠØ§Ù„</div>
        <div class="chip danger">Ø¨Ù†Ø²ÙŠÙ† + Ù…ØµØ±ÙˆÙØ§Øª: <b id="sumCosts">0</b> Ø±ÙŠØ§Ù„</div>
        <div class="chip">ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­: <b id="sumNet">0</b> Ø±ÙŠØ§Ù„</div>
      </div>
    </div>

  </div>

  <footer>ØªØ·Ø¨ÙŠÙ‚ ØªØ¬Ø±ÙŠØ¨ÙŠ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† Ø¥Ù†ØªØ±Ù†Øª (PWA)</footer>

  <script>
    // ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ
    const key = "trips_v1";
    const $ = (id)=>document.getElementById(id);
    const tbody = document.querySelector("#table tbody");
    const filters = document.getElementById("filters");
    let currentRange = "all";

    const load = () => JSON.parse(localStorage.getItem(key) || "[]");
    const save = (arr) => localStorage.setItem(key, JSON.stringify(arr));

    function calcNet(t){
      const plat = (t.income * (t.platform/100));
      const costs = plat + t.fuel + t.extras;
      const net = t.income - costs;
      return {plat: round(plat), costs: round(costs), net: round(net)};
    }
    const round = n => Math.round(n*100)/100;

    function addTrip(){
      const t = {
        id: crypto.randomUUID(),
        date: $("date").value || new Date().toISOString().slice(0,10),
        income: +$("income").value || 0,
        fuel: +$("fuel").value || 0,
        platform: +$("platform").value || 0,
        extras: +$("extras").value || 0,
        hours: +$("hours").value || 0
      };
      const trips = load();
      trips.unshift(t);
      save(trips);
      render();
      clearInputs();
    }

    function clearInputs(){
      ["income","fuel","platform","extras","hours"].forEach(id=>$(id).value="");
    }

    function inRange(d,range){
      const dt = new Date(d);
      const now = new Date();
      switch(range){
        case "day":
          return dt.toDateString()===now.toDateString();
        case "week":{
          const start = new Date(now); start.setDate(now.getDate()-6);
          start.setHours(0,0,0,0);
          return dt>=start && dt<=now;
        }
        case "month":{
          return dt.getMonth()===now.getMonth() && dt.getFullYear()===now.getFullYear();
        }
        case "year":{
          return dt.getFullYear()===now.getFullYear();
        }
        default: return true;
      }
    }

    function render(){
      const trips = load().filter(t=>inRange(t.date,currentRange));
      tbody.innerHTML = "";
      let sumIncome=0,sumPlat=0,sumCosts=0,sumNet=0;
      for(const t of trips){
        const c = calcNet(t);
        sumIncome += t.income;
        sumPlat   += c.plat;
        sumCosts  += (t.fuel + t.extras + c.plat);
        sumNet    += c.net;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${t.date}</td>
          <td>${t.income}</td>
          <td>${t.fuel}</td>
          <td>${t.platform}%</td>
          <td>${t.extras}</td>
          <td><b>${c.net}</b></td>
          <td class="right"><button class="secondary" data-del="${t.id}">Ø­Ø°Ù</button></td>
        `;
        tbody.appendChild(tr);
      }
      $("sumIncome").textContent = round(sumIncome);
      $("sumPlatform").textContent = round(sumPlat);
      $("sumCosts").textContent = round(sumCosts);
      $("sumNet").textContent = round(sumNet);
    }

    // ØªØµØ¯ÙŠØ± CSV
    function exportCSV(){
      const trips = load();
      const rows = [["date","income","fuel","platform%","extras","hours","net"]];
      for(const t of trips){
        const c = calcNet(t);
        rows.push([t.date,t.income,t.fuel,t.platform,t.extras,t.hours,c.net]);
      }
      const csv = rows.map(r=>r.join(",")).join("\n");
      const blob = new Blob([csv],{type:"text/csv;charset=utf-8;"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "trips.csv";
      a.click();
    }

    // Ø­Ø°Ù
    tbody.addEventListener("click",(e)=>{
      const id = e.target.dataset.del;
      if(!id) return;
      const trips = load().filter(t=>t.id!==id);
      save(trips); render();
    });

    // Ø£Ø­Ø¯Ø§Ø«
    $("addBtn").onclick = addTrip;
    $("exportCsv").onclick = exportCSV;
    $("clearAll").onclick = ()=>{ if(confirm("Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„ØŸ")){ save([]); render(); } };
    filters.addEventListener("click",(e)=>{
      if(!e.target.classList.contains("tab")) return;
      document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"));
      e.target.classList.add("active");
      currentRange = e.target.dataset.range;
      render();
    });

    // Ø£ÙˆÙ„ Ø±Ø³Ù…
    render();

    // ØªØ³Ø¬Ø¨Ù„ Ø³ÙŠØ±ÙØ³ ÙˆÙˆØ±ÙƒØ± (PWA)
    if("serviceWorker" in navigator){
      window.addEventListener("load", ()=> {
        navigator.serviceWorker.register("./sw.js").catch(console.error);
      });
    }
  </script>
</body>
</html>
